{% extends "base.html" %}
{% block content %}
<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title">Happening now</h5>
    <p class="card-text">The queue is <span class="{{ 'text-success' if q.is_open else 'text-danger' }}">{{ 'open' if q.is_open else 'closed' }}</span>.</p>
    <p class="card-text"><strong>{{ waiting_count }}</strong> students are waiting. Average wait time <strong>{{ avg_wait }}</strong> mins.</p>
  </div>
</div>

<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">Ask a question</h5>
    <form method="post" action="{{ url_for('ask') }}" enctype="multipart/form-data">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Your name</label>
          <input name="name" class="form-control" value="{{ session.get('name','') }}" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Résumé (pdf, doc, docx, up to 8 MB)</label>
          <input type="file" name="resume" class="form-control" accept=".pdf,.doc,.docx">
        </div>
      </div>
      <div class="mt-3">
        <label class="form-label">Question</label>
        <textarea name="question_body" class="form-control" rows="4" placeholder="Describe what you need help with" required></textarea>
      </div>
      <button class="btn btn-primary mt-3" {% if not q.is_open %}disabled{% endif %}>Ask</button>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <h5 class="card-title">Your recent questions</h5>
    {% if not my_qs %}
      <p class="text-muted">No recent questions.</p>
    {% else %}
      <ul class="list-group">
        {% for r in my_qs %}
        <li class="list-group-item d-flex justify-content-between">
          <span>#{{ r.id }} • {{ r.question_body[:60] }}{% if r.question_body|length > 60 %}…{% endif %} • {{ r.status }}</span>
          <small class="text-muted">{{ r.created_at }}</small>
        </li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</div>
{% endblock %}
